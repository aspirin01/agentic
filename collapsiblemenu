from PyQt6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout,
    QHBoxLayout, QScrollArea, QPushButton
)
from PyQt6.QtGui import QIcon
from PyQt6.QtCore import Qt
import sys

# Sidebar structure (None for non-collapsible items)
section_data = [
    ("Workspace", "icons/flame.png", ["Sign In", "Sign Up"]),
    ("Tools", "icons/pen.jpg", ["File System Tool", "Web Scraper"]),
    ("Agents", "icons/books.jpg", ["Installed Agents", "Marketplace"]),
    ("Record", "icons/record.png", None),
    ("New Chat", "icons/plus.png", None),
]


class CollapsibleSection(QWidget):
    def __init__(self, title="", icon=None, parent=None):
        super().__init__(parent)
        self.layout = QVBoxLayout(self)
        self.layout.setContentsMargins(0, 0, 0, 0)

        self.toggle_button = QPushButton(title)
        if icon:
            self.toggle_button.setIcon(QIcon(icon))
        self.toggle_button.setCheckable(True)
        self.toggle_button.setChecked(False)
        self.toggle_button.setCursor(Qt.CursorShape.PointingHandCursor)
        self.toggle_button.clicked.connect(self.toggle)

        self.toggle_button.setStyleSheet("""
            QPushButton {
                background-color: #f5f5f5;
                padding: 8px 10px;
                font-size: 14px;
                text-align: left;
                border: none;
            }
            QPushButton:hover {
                background-color: #e0e0e0;
            }
        """)

        self.content = QWidget()
        self.content_layout = QVBoxLayout(self.content)
        self.content_layout.setContentsMargins(15, 0, 0, 0)
        self.content_layout.setSpacing(4)
        self.content.setMaximumHeight(0)

        self.layout.addWidget(self.toggle_button)
        self.layout.addWidget(self.content)

    def add_button(self, text, on_click=None):
        btn = QPushButton(text)
        btn.setCursor(Qt.CursorShape.PointingHandCursor)
        btn.setStyleSheet("""
            QPushButton {
                background-color: #ffffff;
                padding: 6px 20px;
                text-align: left;
                border: none;
                font-size: 13px;
            }
            QPushButton:hover {
                background-color: #e8e8e8;
            }
        """)
        if on_click:
            btn.clicked.connect(on_click)
        self.content_layout.addWidget(btn)

    def toggle(self):
        if self.toggle_button.isChecked():
            self.content.setMaximumHeight(16777215)
        else:
            self.content.setMaximumHeight(0)


class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Sidebar: Mixed Collapsible and Flat Buttons")
        self.setGeometry(100, 100, 1000, 600)

        main_widget = QWidget()
        main_layout = QHBoxLayout(main_widget)
        self.setCentralWidget(main_widget)

        # Sidebar setup
        sidebar_scroll = QScrollArea()
        sidebar_scroll.setWidgetResizable(True)
        sidebar_scroll.setFixedWidth(230)
        sidebar_widget = QWidget()
        sidebar_layout = QVBoxLayout(sidebar_widget)
        sidebar_layout.setContentsMargins(0, 10, 0, 10)

        # Dynamically render collapsible and flat buttons
        for title, icon_path, children in section_data:
            if children:  # Render collapsible section
                section = CollapsibleSection(title=title, icon=icon_path)
                for child in children:
                    section.add_button(child)
                sidebar_layout.addWidget(section)
            else:  # Render flat button
                btn = QPushButton(title)
                btn.setIcon(QIcon(icon_path))
                btn.setCursor(Qt.CursorShape.PointingHandCursor)
                btn.setStyleSheet("""
                    QPushButton {
                        background-color: #f5f5f5;
                        padding: 8px 10px;
                        font-size: 14px;
                        text-align: left;
                        border: none;
                    }
                    QPushButton:hover {
                        background-color: #e0e0e0;
                    }
                """)
                sidebar_layout.addWidget(btn)

        sidebar_layout.addStretch()
        sidebar_scroll.setWidget(sidebar_widget)

        main_layout.addWidget(sidebar_scroll)
        main_layout.addWidget(QWidget())  # Placeholder for main content


if __name__ == "__main__":
    app = QApplication(sys.argv)
    win = MainWindow()
    win.show()
    sys.exit(app.exec())