from PyQt6.QtWidgets import (
    QWidget, QVBoxLayout, QToolButton, QSizePolicy,
    QPushButton, QApplication, QFrame
)
from PyQt6.QtCore import Qt


class CollapsibleSection(QWidget):
    def __init__(self, title="", parent=None):
        super().__init__(parent)

        self.toggle_button = QToolButton()
        self.toggle_button.setText(title)
        self.toggle_button.setCheckable(True)
        self.toggle_button.setChecked(False)
        self.toggle_button.setArrowType(Qt.ArrowType.RightArrow)
        self.toggle_button.setToolButtonStyle(Qt.ToolButtonStyle.ToolButtonTextBesideIcon)
        self.toggle_button.clicked.connect(self.on_toggle)

        self.toggle_button.setStyleSheet("""
            QToolButton {
                background-color: #f5f5f5;
                border: none;
                padding: 6px 10px;
                font-size: 14px;
                text-align: left;
            }
            QToolButton:hover {
                background-color: #e0e0e0;
            }
        """)

        self.content_area = QWidget()
        self.content_layout = QVBoxLayout(self.content_area)
        self.content_layout.setContentsMargins(10, 0, 0, 0)
        self.content_layout.setSpacing(5)

        self.content_area.setMaximumHeight(0)
        self.content_area.setSizePolicy(QSizePolicy.Policy.Expanding, QSizePolicy.Policy.Fixed)

        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.addWidget(self.toggle_button)
        layout.addWidget(self.content_area)

    def add_button(self, text, on_click=None):
        btn = QPushButton(text)
        btn.setStyleSheet("""
            QPushButton {
                background-color: #ffffff;
                border: none;
                padding: 6px 20px;
                text-align: left;
                font-size: 13px;
            }
            QPushButton:hover {
                background-color: #e8e8e8;
            }
        """)
        btn.setCursor(Qt.CursorShape.PointingHandCursor)
        if on_click:
            btn.clicked.connect(on_click)
        self.content_layout.addWidget(btn)

    def on_toggle(self):
        if self.toggle_button.isChecked():
            self.toggle_button.setArrowType(Qt.ArrowType.DownArrow)
            self.content_area.setMaximumHeight(16777215)
        else:
            self.toggle_button.setArrowType(Qt.ArrowType.RightArrow)
            self.content_area.setMaximumHeight(0)